/*! bridle 20-09-2013 */
!function(){var a=window.Bridle||{};a.LegendBox=function(){function a(a){a.each(function(a){b=a.length;var g=d3.select(this).selectAll("svg").data([a]),k=g.enter().append("svg").attr("class","bridle").append("g");k.append("g").attr("class","legend"),g.attr("width",e).attr("height",d);var l=g.select("g").attr("transform","translate("+c.left+","+c.top+")"),m=l.select(".legend").selectAll(".legendItem").data(function(a){return a}),n=m.enter().append("g").attr("class","legendItem").on("click",function(a,b){j.legendClick(a,b),m.classed("disabled",function(a){return a.disabled})}).on("mouseover",function(a,b){j.legendMouseover(a,b)}).on("mouseout",function(a,b){j.legendMouseout(a,b)});n.append("circle").attr("class","circle").attr("cx",0).attr("cy",function(){return"-0.25em"}).attr("r",5).attr("stroke-width",1).attr("stroke",function(a,b){return f(b)}).attr("fill",function(a,b){return f(b)}),n.append("foreignObject").attr("class","text").attr("y","-0.85em").attr("x",11).attr("width",e-11).style("overflow","scroll").append("xhtml:body").append("p").attr("class","bridle legend").text(function(a){return i(a)}).each(function(){var a=this.getBoundingClientRect().height;d3.select(this.parentNode.parentNode).attr("height",a)}),m.classed("disabled",function(a){return a.disabled}),m.exit().remove();var o=5,p=0,q=5,r=0;m.attr("opacity",0).attr("transform",function(){return length>r&&(r=length),o+=p,p=this.getBoundingClientRect().height+5,"translate("+q+","+o+")"}).transition().duration(h).attr("opacity",1)})}var b,c={top:5,bottom:5,left:5,right:5},d=200,e=200,f=d3.scale.category10(),g="Chart Title",h=1e3,i=function(a){return a.name},j=d3.dispatch("legendClick","legendMouseover","legendMouseout");return a.dispatch=j,a.margin=function(b){return arguments.length?(c=b,a):c},a.width=function(b){return arguments.length?(e=b,a):e},a.height=function(b){return arguments.length?(d=b,a):d},a.value=function(b){return arguments.length?(value=b,a):value},a.label=function(b){return arguments.length?(label=b,a):label},a.title=function(b){return arguments.length?(g=b,a):g},a.duration=function(b){return arguments.length?(h=b,a):h},a.colors=function(b){return arguments.length?(f=b,a):f},a.nameAccessor=function(b){return arguments.length?(i=b,a):i},a.numData=function(c){return arguments.length?(b=c,a):b},a},a.tooltip={show:function(a,b,c,d){var e=$('<div class="bridle tooltip">');c=c||"s",d=d||20,e.html(b).css({left:-1e3,top:-1e3,opacity:0}).appendTo("body");var f,g,h=e.height()+parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom")),i=e.width()+parseInt(e.css("padding-left"))+parseInt(e.css("padding-right")),j=$(window).width(),k=$(window).height(),l=$("body").scrollTop();switch(c){case"e":case"w":case"n":f=a[0]-i/2,g=a[1]+d,0>f&&(f=5),f+i>j&&(f=j-i-5),g+h>l+k&&(g=a[1]-h-d);break;case"s":f=a[0]-i/2,g=a[1]-h-d,0>f&&(f=5),f+i>j&&(f=j-i-5),l>g&&(g=a[1]+d)}e.css({left:f,top:g,opacity:1})},cleanup:function(){var a=$(".bridle.tooltip");a.css({"transition-delay":"0 !important","-moz-transition-delay":"0 !important","-webkit-transition-delay":"0 !important"}),a.css("opacity",0),setTimeout(function(){a.remove()},500)}},a.BarChart=function(){function b(a){return new Date(a)}function c(b){b.each(function(z){function A(){"grouped"===this.value?(d="grouped",n.domain([0,H]),B()):(d="stacked",n.domain([0,I]),C())}function B(){Q.select(".y.axis").transition().duration(s).attr("transform","translate(-25,0)").call(p),Q.selectAll("g.layerrects").selectAll("rect").transition().duration(500).delay(function(a,b){return 10*b}).attr("x",function(a,b,c){return u(h(a))+u.rangeBand()/J*c}).attr("width",u.rangeBand()/J).transition().attr("y",function(a){return n(a.y)}).attr("height",function(a){return f-n(a.y)-e.top-e.bottom})}function C(){Q.select(".y.axis").transition().duration(s).attr("transform","translate(-25,0)").call(p),Q.selectAll("g.layerrects").selectAll("rect").transition().duration(500).delay(function(a,b){return 10*b}).attr("y",function(a){return n(a.y0+a.y)}).attr("height",function(a){return n(a.y0)-n(a.y0+a.y)}).transition().attr("x",function(a){return u(h(a))}).attr("width",u.rangeBand())}var D=this,E=z.filter(function(a){return!a.disabled});E.forEach(function(a){k(a).sort(x)}),E=d3.layout.stack().offset(l).order(m).values(k).x(h).y(i)(E);var F=t.width();t.height(f),u.domain(E[0].values.map(function(a){return h(a)})).rangeRoundBands([0,g-(e.right+F)],.1);var G=function(){var a=0;return E.forEach(function(b){a+=b.values.length}),a/E.length};v.tickFormat(w).tickValues(u.domain().filter(function(a,b){var c=Math.ceil(200/(g/G()));return!(b%c)}));var H=d3.max(E,function(a){return d3.max(a.values,function(a){return a.y})}),I=d3.max(E,function(a){return d3.max(a.values,function(a){return a.y0+a.y})}),J=E.length;d3.max(E,function(a){return a.values.length}),n.range([f-e.top-e.bottom,0]),"stacked"===d?n.domain([0,I]):n.domain([0,H]);var K=function(a,b,c){return"stacked"===d?u(h(a)):u(h(a))+u.rangeBand()/J*c},L=function(a){return"stacked"===d?n(a.y0+a.y):n(a.y)},M=function(a){return"stacked"===d?n(a.y0)-n(a.y0+a.y):f-n(a.y)-e.top-e.bottom},N=function(){return"stacked"===d?u.rangeBand():u.rangeBand()/J},O=d3.select(D).selectAll("svg").data([E]),P=O.enter().append("svg").attr("class","bridle").append("g");P.append("g").attr("class","rects"),P.append("g").attr("class","x axis"),P.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".72em").attr("class","y axis label").attr("text-anchor","middle"),P.append("svg:text").attr("class","chartTitle label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+(g-e.left-e.right+20)/2+","+-e.top+")"),P.append("g").attr("class","legend").attr("transform","translate("+(g-(e.right+F)+20)+","+0+")").style("font-size","12px"),O.attr("width",g).attr("height",f);var Q=O.select("g").attr("transform","translate("+e.left+","+e.top+")"),R=Q.select(".rects").selectAll("g.layerrects").data(function(a){return a},function(a){return j(a)}).classed("hover",function(a){return a.hover});R.exit().transition().duration(s).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var S=R.enter(),T=S.append("g").attr("class","layerrects").attr("fill",function(a){return o(j(a))}).selectAll("g.rect").data(function(a){return a.values.forEach(function(b){b.name=j(a)}),a.values});T.exit().transition().duration(s).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var U=T.enter().append("g").attr("class","rect");U.append("rect").attr("opacity",.1).attr("x",function(a,b,c){return K(a,b,c)}).attr("y",function(){return f-e.top-e.bottom}).attr("width",function(){return N()}).attr("height",0).on("mouseover",function(a,b,c){y.pointMouseover({x:h(a),y:i(a),series:a.name,pos:[u(h(a)),L(a)],pointIndex:b,seriesIndex:c})}).on("mouseout",function(){y.pointMouseout({})}),Q.selectAll("g.layerrects").selectAll("g.rect").select("rect").transition().duration(s).attr("opacity",.9).attr("y",function(a){return L(a)}).attr("height",function(a){return M(a)}).attr("width",function(){return N()}).attr("x",function(a,b,c){return K(a,b,c)}),Q.select("text.chartTitle").text(q),Q.select(".x.axis").attr("transform","translate(0,"+n.range()[0]+")").call(v),Q.select(".y.axis").transition().duration(s).attr("transform","translate(-25,0)").call(p),Q.select(".y.axis.label").attr("y",-45).attr("x",(-f+e.top+e.bottom)/2).attr("dy",".1em").text(r),d3.selectAll("input.bridle.modeChanger").on("change",A),t.numData()!=z.length&&Q.select(".legend").call(t),t.dispatch.on("legendClick",function(a){a.disabled=!a.disabled,E.filter(function(a){return!a.disabled}).length||E.forEach(function(a){a.disabled=!1}),b.call(c)}),t.dispatch.on("legendMouseover",function(a){a.hover=!0,b.call(c)}),t.dispatch.on("legendMouseout",function(a){a.hover=!1,b.call(c)}),y.on("pointMouseover.tooltip",function(b){var c=$(D).offset(),d=b.pos[0]+c.left+e.left,f=b.pos[1]+c.top+e.top,g=d3.time.format("%Y-%m-%d"),h=d3.format(".02f"),i="<h3>"+b.series+"</h3>"+"<p>"+'<span class="value">['+g(b.x)+", "+h(b.y)+"]</span>"+"</p>";a.tooltip.show([d,f],i)}),y.on("pointMouseout.tooltip",function(){a.tooltip.cleanup()})})}var d="stacked",e={top:50,bottom:100,left:100,right:100},f=400,g=1e3,h=function(a){return a.x},i=function(a){return a.y},j=function(a){return a.name},k=function(a){return a.values},l="zero",m="default",n=d3.scale.linear(),o=d3.scale.category10(),p=d3.svg.axis().scale(n).orient("left"),q="Chart Title",r="Axis Title",s=1e3,t=a.LegendBox().nameAccessor(function(a){return j(a)}),u=d3.scale.ordinal(),v=d3.svg.axis().scale(u).tickSize(5).orient("bottom"),w=d3.time.format("%Y-%m-%d"),x=function(a,c){return b(h(a))>b(h(c))?1:-1},y=d3.dispatch("showTooltip","hideTooltip","pointMouseover","pointMouseout");return c.dispatch=y,c.margin=function(a){return arguments.length?(e=a,c):e},c.width=function(a){return arguments.length?(g=a,c):g},c.height=function(a){return arguments.length?(f=a,c):f},c.value=function(a){return arguments.length?(value=a,c):value},c.label=function(a){return arguments.length?(label=a,c):label},c.title=function(a){return arguments.length?(q=a,c):q},c.xAxis=function(a){return arguments.length?(v=a,c):v},c.yAxis=function(a){return arguments.length?(p=a,c):p},c.yAxisTitle=function(a){return arguments.length?(r=a,c):r},c.duration=function(a){return arguments.length?(s=a,c):s},c.tickFormat=function(a){return arguments.length?(w=a,c):w},c.legend=function(a){return arguments.length?(t=a,c):t},c.xValue=function(a){return arguments.length?(h=a,c):h},c.yValue=function(a){return arguments.length?(i=a,c):i},c.nameValue=function(a){return arguments.length?(j=a,c):j},c.values=function(a){return arguments.length?(k=a,c):k},c.colors=function(a){return arguments.length?(o=a,c):o},c.mode=function(a){return arguments.length?(d=a,c):d},c},a.BarChartCategorical=function(){function b(x){x.each(function(y){function z(){"grouped"===this.value?(c="grouped",l.domain([0,F]),A()):(c="stacked",l.domain([0,G]),B())}function A(){O.select(".y.axis").transition().duration(q).attr("transform","translate(-25,0)").call(n),O.selectAll("g.layerrects").selectAll("rect").transition().duration(500).delay(function(a,b){return 10*b}).attr("x",function(a,b,c){return s(g(a))+s.rangeBand()/H*c}).attr("width",s.rangeBand()/H).transition().attr("y",function(a){return l(a.y)}).attr("height",function(a){return e-l(a.y)-d.top-d.bottom})}function B(){O.select(".y.axis").transition().duration(q).attr("transform","translate(-25,0)").call(n),O.selectAll("g.layerrects").selectAll("rect").transition().duration(500).delay(function(a,b){return 10*b}).attr("y",function(a){return l(a.y0+a.y)}).attr("height",function(a){return l(a.y0)-l(a.y0+a.y)}).transition().attr("x",function(a){return s(g(a))}).attr("width",s.rangeBand())}var C=this,D=y.filter(function(a){return!a.disabled});D=d3.layout.stack().offset(j).order(k).values(function(a){return a.values}).x(g).y(h)(D);var E=r.width();r.height(e),s.domain(D[0].values.map(function(a){return g(a)})).rangeRoundBands([0,f-(d.right+E)],.1);var F=d3.max(D,function(a){return d3.max(a.values,function(a){return a.y})}),G=d3.max(D,function(a){return d3.max(a.values,function(a){return a.y0+a.y})}),H=D.length;d3.max(D,function(a){return a.values.length}),l.range([e-(d.top+d.bottom),0]),"stacked"===c?l.domain([0,G]):l.domain([0,F]);var I=function(a,b,d){return"stacked"===c?s(g(a)):s(g(a))+s.rangeBand()/H*d},J=function(a){return"stacked"===c?l(a.y0+a.y):l(a.y)},K=function(a){return"stacked"===c?l(a.y0)-l(a.y0+a.y):e-l(a.y)-d.top-d.bottom},L=function(){return"stacked"===c?s.rangeBand():s.rangeBand()/H},M=d3.select(C).selectAll("svg").data([D]),N=M.enter().append("svg").attr("class","bridle").append("g");N.append("g").attr("class","rects"),N.append("g").attr("class","x axis"),N.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".72em").attr("class","y axis label").attr("text-anchor","middle"),N.append("svg:text").attr("class","chartTitle label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+(f-d.left-d.right+20)/2+","+-d.top+")"),N.append("g").attr("class","legend").attr("transform","translate("+(f-(d.right+E)+20)+","+0+")").style("font-size","12px"),M.attr("width",f).attr("height",e);var O=M.select("g").attr("transform","translate("+d.left+","+d.top+")"),P=O.select(".rects").selectAll("g.layerrects").data(function(a){return a},function(a){return i(a)}).classed("hover",function(a){return a.hover});P.exit().transition().duration(q).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var Q=P.enter(),R=Q.append("g").attr("class","layerrects").attr("fill",function(a){return m(i(a))}).selectAll("g.rect").data(function(a){return a.values.forEach(function(b){b.name=i(a)}),a.values});R.exit().transition().duration(q).style("stroke-opacity",1e-6).style("fill-opacity",1e-6).remove();var S=R.enter().append("g").attr("class","rect");S.append("rect").attr("opacity",.1).attr("x",function(a,b,c){return I(a,b,c)}).attr("y",function(){return e-d.top-d.bottom}).attr("width",function(){return L()}).attr("height",0).on("mouseover",function(a,b,c){w.pointMouseover({x:g(a),y:h(a),series:a.name,pos:[s(g(a)),J(a)],pointIndex:b,seriesIndex:c})}).on("mouseout",function(){w.pointMouseout({})}),O.selectAll("g.layerrects").selectAll("g.rect").select("rect").transition().duration(q).attr("opacity",.9).attr("y",function(a){return J(a)}).attr("height",function(a){return K(a)}).attr("width",function(){return L()}).attr("x",function(a,b,c){return I(a,b,c)}),O.select("text.chartTitle").text(o),O.select(".x.axis").attr("transform","translate(0,"+l.range()[0]+")").call(t).selectAll("text").text(u).style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-45)"}).on("mouseover",function(a){var b=d3.select(this),c=0,d=20;a.length>c+d&&(this._interval=setInterval(function(){var e="";c>d?(strA=a.slice(c,a.length),strB=a.slice(0,d),e=strA+" - "+strB):e=a.slice(c,d),b.text(e),c=++c%a.length,d=++d%a.length},200))}).on("mouseout",function(){clearInterval(this._interval),d3.select(this).text(u)}),O.select(".y.axis").transition().duration(q).attr("transform","translate(-25,0)").call(n),O.select(".y.axis.label").attr("y",-45).attr("x",(-e+d.top+d.bottom)/2).attr("dy",".1em").text(p),d3.selectAll("input.bridle.modeChanger").on("change",z),r.numData()!=y.length&&O.select(".legend").datum(D).call(r),r.dispatch.on("legendClick",function(a){a.disabled=!a.disabled,D.filter(function(a){return!a.disabled}).length||D.forEach(function(a){a.disabled=!1}),x.call(b)}),r.dispatch.on("legendMouseover",function(a){a.hover=!0,x.call(b)}),r.dispatch.on("legendMouseout",function(a){a.hover=!1,x.call(b)}),w.on("pointMouseover.tooltip",function(b){var c=$(C).offset(),e=b.pos[0]+c.left+d.left,f=b.pos[1]+c.top+d.top,g="<h3>"+b.series+"</h3>"+"<p>"+'<span class="value">['+u(b.x)+", "+v(b.y)+"]</span>"+"</p>";a.tooltip.show([e,f],g)}),w.on("pointMouseout.tooltip",function(){a.tooltip.cleanup()})})}var c="stacked",d={top:50,bottom:150,left:100,right:100},e=400,f=1e3,g=function(a){return a.x},h=function(a){return a.y},i=function(a){return a.name},j="zero",k="default",l=d3.scale.linear(),m=d3.scale.category10(),n=d3.svg.axis().scale(l).orient("left"),o="Chart Title",p="Axis Title",q=1e3,r=a.LegendBox().nameAccessor(function(a){return i(a)}),s=d3.scale.ordinal(),t=d3.svg.axis().scale(s).tickSize(5).orient("bottom"),u=function(a){return a.length>20?a.slice(0,19)+"…":a},v=d3.format(".02f"),w=d3.dispatch("showTooltip","hideTooltip","pointMouseover","pointMouseout");return b.dispatch=w,b.margin=function(a){return arguments.length?(d=a,b):d},b.width=function(a){return arguments.length?(f=a,b):f},b.height=function(a){return arguments.length?(e=a,b):e},b.value=function(a){return arguments.length?(value=a,b):value},b.label=function(a){return arguments.length?(label=a,b):label},b.title=function(a){return arguments.length?(o=a,b):o},b.xAxis=function(a){return arguments.length?(t=a,b):t},b.yAxis=function(a){return arguments.length?(n=a,b):n},b.yAxisTitle=function(a){return arguments.length?(p=a,b):p},b.duration=function(a){return arguments.length?(q=a,b):q},b.formatterX=function(a){return arguments.length?(u=a,b):u},b.formatterY=function(a){return arguments.length?(v=a,b):v},b.legend=function(a){return arguments.length?(r=a,b):r},b.xValue=function(a){return arguments.length?(g=a,b):g},b.yValue=function(a){return arguments.length?(h=a,b):h},b.nameValue=function(a){return arguments.length?(i=a,b):i},b.colors=function(a){return arguments.length?(m=a,b):m},b.mode=function(a){return arguments.length?(c=a,b):c},b};var a=a||{};a.DualAxisChart=function(){function b(b){b.each(function(b){b.values.sort(G);var e=E.width();E.height(j),r.domain(b.values.map(function(a){return l(a)})).rangeRoundBands([0,k-(i.right+e+i.left)],.1),v.tickFormat(w),p.range([j-i.top-i.bottom,0]).domain([0,d3.max(b.values,function(a){return m(a)})]),q.range([j-i.top-i.bottom,0]).domain([0,d3.max(b.values,function(a){return n(a)})]);var H=d3.select(this).selectAll("svg").data([b]),I=H.enter().append("svg").attr("class","bridle").append("g");I.append("g").attr("class","barSeries"),I.append("g").attr("class","lineSeries").append("g").attr("class","circles"),I.append("g").attr("class","x axis"),I.append("g").attr("class","y axis left").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".72em").attr("class","y axis left label").attr("text-anchor","middle"),I.append("g").attr("class","y axis right").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","1.72em").attr("class","y axis right label").attr("text-anchor","middle"),I.append("svg:text").attr("class","chartTitle label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+(k-(i.left+e+i.left))/2+","+-i.top+")"),I.append("g").attr("class","legend").attr("transform","translate("+(k-(i.right+e)+20)+","+0+")").style("font-size","12px"),H.attr("width",k).attr("height",j);var J=H.select("g").attr("transform","translate("+i.left+","+i.top+")"),K=H.select(".barSeries"),L=K.selectAll("rect").data(function(a){return a.values});L.enter().append("rect").attr("class","bar").attr("fill",s(1)).attr("fill-opacity",0).attr("x",f).attr("y",j-i.top-i.bottom).attr("height",0).attr("width",r.rangeBand()).on("mouseover",c).on("mouseout",d),K.selectAll("rect").transition().duration(o).attr("height",function(a){return j-h(a)-i.top-i.bottom}).attr("y",h).attr("fill-opacity",1);var M=H.select(".lineSeries"),N=M.selectAll("path.line").data(function(a){return[a]});N.enter().append("path").attr("class","line").attr("stroke",s(0)).attr("stroke-opacity",0).attr("stroke-width",1.5).attr("fill","none").transition().duration(o).attr("stroke-opacity",1),N.exit().remove(),M.select("path").attr("d",function(a){return D(a.values)});var O=M.select("g.circles").selectAll("circle").data(function(a){return a.values}),P=O.enter();P.append("circle").attr("opacity",0).attr("fill",s(0)).attr("class","seriesPoint").attr("r",0),O.attr("cx",function(a){return f(a)+r.rangeBand()/2}).attr("cy",g).on("mouseover",c).on("mouseout",d).transition().duration(o).attr("opacity",1).attr("r",3),O.exit().remove(),J.select("text.chartTitle").text(A),J.select(".x.axis").attr("transform","translate(0,"+p.range()[0]+")").call(v).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(){return"rotate(-65)"}),J.select(".y.axis.left").attr("transform","translate(-25,0)").attr("opacity",0).transition().duration(o).attr("opacity",1).call(t).selectAll("text").attr("fill",s(0)),J.select(".y.axis.right").attr("opacity",0).attr("transform","translate("+(k-(e+i.right+i.left)+25)+",0)").transition().duration(o).attr("opacity",1).call(u).selectAll("text").attr("fill",s(1)),J.select(".y.axis.left.label").attr("y",-45).attr("x",(-j+i.top+i.bottom)/2).attr("dy",".1em").text(B),J.select(".y.axis.right.label").attr("y",55).attr("x",(-j+i.top+i.bottom)/2).attr("dy",".1em").text(C),J.select(".legend").datum(b.measures).call(E),F.on("pointMouseover.tooltip",function(c){var d=c.pos[0],e=c.pos[1],f="<h3>"+x(c.x)+'</h3><div class="rightValue">'+'<div class="rightLabel">'+b.measures[0]+":</div>"+'<div class="rightVal">'+z(c.yRight)+"</div>"+'</div><div class="leftValue">'+'<div class="leftLabel">'+b.measures[1]+":</div>"+'<div class="leftVal">'+y(c.yLeft)+"</div>"+"</div>";a.tooltip.show([d,e],f)}),F.on("pointMouseout.tooltip",function(){a.tooltip.cleanup()})})}function c(a,b,c){var d=d3.mouse(document.body);F.pointMouseover({x:l(a),pos:d,yLeft:m(a),yRight:n(a),series:a.name,pointIndex:b,seriesIndex:c})}function d(){F.pointMouseout({})}function e(a){return new Date(a)}function f(a){return r(l(a))}function g(a){return p(m(a))}function h(a){return q(n(a))}var i={top:50,bottom:70,left:100,right:150},j=400,k=800,l=function(a){return new Date(a.z)},m=function(a){return a.v},n=function(a){return a.w},o=1e3,p=d3.scale.linear(),q=d3.scale.linear(),r=d3.scale.ordinal(),s=d3.scale.category10(),t=d3.svg.axis().scale(p).orient("left"),u=d3.svg.axis().scale(q).orient("right"),v=d3.svg.axis().scale(r).orient("bottom"),w=d3.time.format("%Y-%m-%d"),x=d3.time.format("%Y-%m-%d"),y=d3.format(".02f"),z=d3.format(".02f"),A="Chart Title",B="Left Axis Title",C="Right Axis Title",D=d3.svg.line().x(function(a){return f(a)+r.rangeBand()/2}).y(function(a){return g(a)}),E=a.LegendBox().nameAccessor(function(a){return a}),F=d3.dispatch("showTooltip","hideTooltip","pointMouseover","pointMouseout"),G=function(a,b){return e(l(a))>e(l(b))?1:-1};return b.margin=function(a){return arguments.length?(i=a,b):i},b.width=function(a){return arguments.length?(k=a,b):k},b.height=function(a){return arguments.length?(j=a,b):j},b.value=function(a){return arguments.length?(value=a,b):value},b.label=function(a){return arguments.length?(label=a,b):label},b.title=function(a){return arguments.length?(A=a,b):A},b.xScale=function(a){return arguments.length?(r=a,b):r},b.yLeftScale=function(a){return arguments.length?(p=a,b):p},b.yRightScale=function(a){return arguments.length?(q=a,b):q},b.xAxis=function(a){return arguments.length?(v=a,b):v},b.yAxis=function(a){return arguments.length?(yAxis=a,b):yAxis},b.yLeftAxisTitle=function(a){return arguments.length?(B=a,b):B},b.yRightAxisTitle=function(a){return arguments.length?(C=a,b):C},b.duration=function(a){return arguments.length?(o=a,b):o},b.legend=function(a){return arguments.length?(E=a,b):E},b.xValue=function(a){return arguments.length?(l=a,b):l},b.yLeftValue=function(a){return arguments.length?(m=a,b):m},b.yRightValue=function(a){return arguments.length?(n=a,b):n},b.formatterX=function(a){return arguments.length?(x=a,b):x},b.formatterY=function(a){return arguments.length?(formatterY=a,b):formatterY},b.nameValue=function(a){return arguments.length?(nameValue=a,b):nameValue},b.colors=function(a){return arguments.length?(s=a,b):s},b},a.LineChart=function(){"use Strict";function b(u){u.each(function(v){n.scale(l),o.scale(m);var w=q.width();q.height(d);var x=this,y=v.filter(function(a){return!a.disabled}),z=y.map(function(a){return d3.max(a.values,function(a){return f(a)})}),A=y.map(function(a){return d3.min(a.values,function(a){return f(a)})});l.domain([d3.min(A),d3.max(z)]).range([0,e-(c.right+w)]),l(f(y[0].values[1]))-l(f(y[0].values[0]));var B=y.map(function(a){return d3.max(a.values,function(a){return g(a)})});m.domain([0,d3.max(B)]).range([d-c.top-c.bottom,0]);var C=d3.svg.line().x(function(a){return l(f(a))}).y(function(a){return m(g(a))}),D=d3.select(this).selectAll("svg").data([y]),E=D.enter().append("svg").attr("class","bridle").append("g");E.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e-(c.right+w)).attr("height",d-c.top-c.bottom),E.append("g").attr("class","x axis"),E.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".72em").attr("class","y axis label").attr("text-anchor","middle"),E.append("svg:text").attr("class","chartTitle label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+(e-c.left-c.right+20)/2+","+-c.top+")"),E.append("g").attr("class","legend").attr("transform","translate("+(e-(c.right+w)+20)+","+0+")").style("font-size","12px"),E.append("g").attr("class","lines"),D.attr("width",e).attr("height",d);var F=D.select("g").attr("transform","translate("+c.left+","+c.top+")");D.select("defs").select("clippath").select("rect").attr("width",e-(c.right+w)).attr("height",d-c.top-c.bottom);var G=D.select(".lines").selectAll("g.series").data(function(a){return a},function(a){return h(a)}).classed("hover",function(a){return a.hover});G.exit().transition().duration(k).style("opacity",0).remove(),G.enter().append("g").attr("class","series").attr("id",function(a){return"series_"+h(a)});var H=G.selectAll("path.line").data(function(a){return[a]});H.enter().append("path").attr("stroke",function(a){return p(h(a))}).attr("class","line").attr("stroke-opacity",0).attr("d",function(a){return C(a.values)});var I=G.selectAll("g.circles").data(function(a){return a.values.forEach(function(b){b.name=h(a)}),[a.values]});I.enter().append("g").attr("class","circles");var J=G.select("g.circles").selectAll("circle").data(function(a){return a.values},function(a){return f(a)}),K=J.enter();K.append("circle").attr("opacity",.1).attr("class","seriespoint").attr("r",0).attr("cx",function(a){return l(f(a))}).attr("cy",function(a){return m(g(a))}).on("mouseover",function(a,b,c){t.pointMouseover({x:f(a),y:g(a),series:a.name,pos:[l(f(a)),m(g(a))],pointIndex:b,seriesIndex:c})}).on("mouseout",function(){t.pointMouseout({})}),J.exit().attr("fill-opacity",0).attr("r",0).remove(),G.selectAll("path.line").attr("stroke",function(a){return p(h(a))}).attr("fill","none").attr("d",function(a){return C(a.values)}).attr("clip-path","url(#clip)").transition().duration(k).ease("linear").attr("stroke-opacity",1).attr("stroke-width",1.5),G.selectAll("circle.seriespoint").transition().duration(k).ease("linear").attr("r",5).attr("cx",function(a){return l(f(a))}).attr("cy",function(a){return m(g(a))}),F.select("text.chartTitle").text(i),F.select(".x.axis").attr("transform","translate(0,"+m.range()[0]+")").transition().duration(k).ease("linear").call(n),F.select(".y.axis").transition().duration(k).attr("transform","translate(-25,0)").call(o),F.select(".y.axis.label").attr("y",-45).attr("x",(-d+c.top+c.bottom)/2).attr("dy",".1em").text(j),q.numData()!=v.length&&F.select(".legend").datum(y).call(q),q.dispatch.on("legendClick",function(a){a.disabled=!a.disabled,y.filter(function(a){return!a.disabled}).length||y.forEach(function(a){a.disabled=!1}),u.call(b)}),q.dispatch.on("legendMouseover",function(a){a.hover=!0,u.call(b)}),q.dispatch.on("legendMouseout",function(a){a.hover=!1,u.call(b)}),t.on("pointMouseover.tooltip",function(b){var d=$(x).offset(),e=b.pos[0]+d.left+c.left,f=b.pos[1]+d.top+c.top,g="<h3>"+b.series+"</h3>"+"<p>"+'<span class="value">['+r(b.x)+", "+s(b.y)+"]</span>"+"</p>";a.tooltip.show([e,f],g)}),t.on("pointMouseout.tooltip",function(){a.tooltip.cleanup()})})}var c={top:50,bottom:30,left:100,right:30},d=400,e=1e3,f=function(a){return a.x},g=function(a){return a.y},h=function(a){return a.name},i="Chart Title",j="Axis Title",k=1e3,l=d3.time.scale.utc(),m=d3.scale.linear().nice(),n=d3.svg.axis().orient("bottom");n.tickSize(-d+c.top+c.bottom,0),n.tickSubdivide(!0);var o=d3.svg.axis().orient("left"),p=d3.scale.category10(),q=a.LegendBox().nameAccessor(function(a){return h(a)}),r=d3.time.format("%Y-%m-%d"),s=d3.format(".02f"),t=d3.dispatch("showTooltip","hideTooltip","pointMouseover","pointMouseout");return b.dispatch=t,b.margin=function(a){return arguments.length?(c=a,b):c},b.width=function(a){return arguments.length?(e=a,b):e},b.height=function(a){return arguments.length?(d=a,b):d},b.value=function(a){return arguments.length?(value=a,b):value},b.label=function(a){return arguments.length?(label=a,b):label},b.title=function(a){return arguments.length?(i=a,b):i},b.xScale=function(a){return arguments.length?(l=a,b):l},b.yScale=function(a){return arguments.length?(m=a,b):m},b.xAxis=function(a){return arguments.length?(n=a,b):n},b.yAxis=function(a){return arguments.length?(o=a,b):o},b.yAxisTitle=function(a){return arguments.length?(j=a,b):j},b.duration=function(a){return arguments.length?(k=a,b):k},b.legend=function(a){return arguments.length?(q=a,b):q},b.xValue=function(a){return arguments.length?(f=a,b):f},b.yValue=function(a){return arguments.length?(g=a,b):g},b.formatterX=function(a){return arguments.length?(r=a,b):r},b.formatterY=function(a){return arguments.length?(s=a,b):s},b.nameValue=function(a){return arguments.length?(h=a,b):h},b.colors=function(a){return arguments.length?(p=a,b):p},b},a.StackedChart=function(){function b(a){return o(i(a))}function c(a){return p(a.y0)}function d(a){return p(a.y0+a.y)}function e(c){c.each(function(n){r.scale(o),s.scale(p);var B=this;data=n.filter(function(a){return!a.disabled}),data=d3.layout.stack().offset(l).order(m).values(function(a){return a.values}).x(i).y(j)(data);var C=x.width();x.height(g),o.range([0,h-(f.right+C)]);var D=data.map(function(a){return d3.max(a.values,function(a){return i(a)})}),E=data.map(function(a){return d3.min(a.values,function(a){return i(a)})});o.domain([d3.min(E),d3.max(D)]),p.range([g-f.top-f.bottom,0]);var F=data.map(function(a){return d3.max(a.values,function(a){return a.y+a.y0})});p.domain([0,d3.max(F)]);var G=d3.select(this).selectAll("svg").data([data]),H=G.enter().append("svg").attr("class","bridle").append("g");H.append("g").attr("class","x axis"),H.append("g").attr("class","y axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".72em").attr("class","y axis label").attr("text-anchor","middle"),H.append("svg:text").attr("class","chartTitle label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+(h-f.left-f.right+20)/2+","+-f.top+")"),H.append("g").attr("class","legend").attr("transform","translate("+(h-(f.right+C)+20)+","+0+")").style("font-size","12px"),H.append("g").attr("class","areas"),H.append("g").attr("class","circles"),G.attr("width",h).attr("height",g);var I=G.select("g").attr("transform","translate("+f.left+","+f.top+")"),J=I.select(".areas").selectAll("g.area").data(function(a){return a},function(a){return k(a)}).classed("hover",function(a){return a.hover}),K=J.enter().insert("g").attr("class","area");K.append("path").attr("class","area").attr("fill",function(a){return q(k(a))}).attr("fill-opacity",0).attr("d",function(a){return t(a.values)});var L=I.select(".circles").selectAll("g.seriespoints").data(function(a){return a},function(a){return k(a)}).classed("hover",function(a){return a.hover});L.enter().append("g").attr("class","seriespoints"),L.exit().remove();var M=L.selectAll("circle").data(function(a){return a.values.forEach(function(b){b.name=k(a)}),a.values});M.enter().append("circle").attr("fill-opacity",.1).attr("class","seriespoint").attr("r",0).attr("cx",function(a){return b(a)}).attr("cy",function(a){return d(a)}).on("mouseover",function(a,b,c){y.pointMouseover({x:i(a),y:j(a),series:a.name,pos:[o(i(a)),p(a.y0+a.y)],pointIndex:b,seriesIndex:c})}).on("mouseout",function(){y.pointMouseout({})});var N=J.exit().transition().duration(w).style("opacity",0).remove();M.exit().attr("fill-opacity",0).attr("r",0).remove(),N.selectAll("path").attr("stroke-opacity",0).attr("fill-opacity",0).remove(),I.selectAll("path.area").attr("fill",function(a){return q(k(a))}).transition().duration(w).attr("fill-opacity",.8).attr("d",function(a){return t(a.values)}),I.selectAll("circle.seriespoint").transition().duration(w).attr("r",5).attr("cx",function(a){return b(a)}).attr("cy",function(a){return d(a)}),I.select("text.chartTitle").text(u),I.select(".x.axis").attr("transform","translate(0,"+p.range()[0]+")").call(r),I.select(".y.axis").transition().duration(w).attr("transform","translate(-25,0)").call(s),I.select(".y.axis.label").attr("y",-45).attr("x",(-g+f.top+f.bottom)/2).attr("dy",".1em").text(v),x.numData()!=n.length&&I.select(".legend").datum(data).call(x),x.dispatch.on("legendClick",function(a){a.disabled=!a.disabled,data.filter(function(a){return!a.disabled
}).length||data.forEach(function(a){a.disabled=!1}),c.call(e)}),x.dispatch.on("legendMouseover",function(a){a.hover=!0,c.call(e)}),x.dispatch.on("legendMouseout",function(a){a.hover=!1,c.call(e)}),y.on("pointMouseover.tooltip",function(b){var c=$(B).offset(),d=b.pos[0]+c.left+f.left,e=b.pos[1]+c.top+f.top,g="<h3>"+b.series+"</h3>"+"<p>"+'<span class="value">['+z(b.x)+", "+A(b.y)+"]</span>"+"</p>";a.tooltip.show([d,e],g)}),y.on("pointMouseout.tooltip",function(){a.tooltip.cleanup()})})}var f={top:50,bottom:30,left:100,right:100},g=400,h=1e3,i=function(a){return a.x},j=function(a){return a.y},k=function(a){return a.name},l="zero",m="default",n="linear",o=d3.time.scale.utc(),p=d3.scale.linear().nice(),q=d3.scale.category10(),r=d3.svg.axis().orient("bottom"),s=d3.svg.axis().orient("left");r.tickSize(-g+f.top+f.bottom,0),r.tickSubdivide(!0);var t=d3.svg.area().interpolate(n).x(b).y0(c).y1(d),u="Chart Title",v="Axis Title",w=1e3,x=a.LegendBox().nameAccessor(function(a){return k(a)}),y=d3.dispatch("showTooltip","hideTooltip","pointMouseover","pointMouseout"),z=d3.time.format("%Y-%m-%d"),A=d3.format(".02f");return e.dispatch=y,e.margin=function(a){return arguments.length?(f=a,e):f},e.width=function(a){return arguments.length?(h=a,e):h},e.height=function(a){return arguments.length?(g=a,e):g},e.value=function(a){return arguments.length?(value=a,e):value},e.label=function(a){return arguments.length?(label=a,e):label},e.title=function(a){return arguments.length?(u=a,e):u},e.xScale=function(a){return arguments.length?(o=a,e):o},e.yScale=function(){return arguments.length?e:p},e.xAxis=function(a){return arguments.length?(r=a,e):r},e.yAxis=function(a){return arguments.length?(s=a,e):s},e.yAxisTitle=function(a){return arguments.length?(v=a,e):v},e.duration=function(a){return arguments.length?(w=a,e):w},e.legend=function(a){return arguments.length?(x=a,e):x},e.xValue=function(a){return arguments.length?(i=a,e):i},e.formatterX=function(a){return arguments.length?(z=a,e):z},e.formatterY=function(a){return arguments.length?(A=a,e):A},e.yValue=function(a){return arguments.length?(j=a,e):j},e.nameValue=function(a){return arguments.length?(k=a,e):k},e.colors=function(a){return arguments.length?(q=a,e):q},e},a.spiderChart=function(){function a(a){a.each(function(a){i=(Math.min(g,h)-f)/2,maxX=d3.max(a,k)>0?d3.max(a,k):1,p.domain([0,maxX]).range([0,i]),a=a.map(function(b,e){return{x:c(b,e,a.length),y:d(b,e,a.length),val:k(b),label:l(b)}});var r=d3.select(this).selectAll("svg").data([a]),s=r.enter().append("svg").append("g");s.append("text").attr("class","title label"),s.append("text").attr("class","subtitle label"),s.append("g").attr("class","grid"),s.append("g").attr("class","axes"),s.append("path").attr("class","spider"),r.attr("width",h),r.attr("height",g);var t=r.select("g").attr("transform","translate("+h/2+","+g/2+")"),u=e(a.length,j);t.select(".grid").selectAll(".gridlevel").data(u).enter().append("path").attr("class","gridlevel").style("stroke","#000").style("fill","none").style("opacity",.3).attr("d",q);var v=t.select("g.axes").selectAll("g.axis").data(a),w=v.enter().append("g").attr("class","axis");w.append("svg:text").style("text-anchor",function(c,d){var e=Math.sin(b(d,a.length))*p(p.domain()[1]);return Math.abs(e)<.1?"middle":e>0?"start":"end"}).attr("dy",function(c,d){var e=Math.cos(b(d,a.length))*p(p.domain()[1]);return Math.abs(e)<.1?".72em":e>0?"1em":"-.3em"}).style("fill","#333").style("font-size","9pt").style("opacity",.6).text(function(a){return a.label}).attr("x",function(c,d){return Math.sin(b(d,a.length))*p(p.domain()[1])}).attr("y",function(c,d){return Math.cos(b(d,a.length))*p(p.domain()[1])}),w.append("svg:line").style("stroke","#000").style("fill","none").style("opacity",.1).attr("x1",function(c,d){return Math.sin(b(d,a.length))*p(p.domain()[0])}).attr("y1",function(c,d){return Math.cos(b(d,a.length))*p(p.domain()[0])}).attr("x2",function(c,d){return Math.sin(b(d,a.length))*p(p.domain()[1])}).attr("y2",function(c,d){return Math.cos(b(d,a.length))*p(p.domain()[1])}),t.select(".title").text(function(){return n}).attr("y",-g/2).attr("dy","1.72em").style("text-anchor","middle"),t.select(".subtitle").text(o).style("font-weight","200").style("font-size","10px").attr("dy",40).attr("y",-g/2).style("text-anchor","middle"),t.select(".spider").transition().duration(m).style("fill","#000").style("opacity",.8).attr("d",q)})}function b(a,b){return a*(2*Math.PI/b)+Math.PI/b}function c(a,c,d){var e=p(k(a));return Math.sin(b(c,d))*e}function d(a,c,d){var e=p(k(a));return Math.cos(b(c,d))*e}function e(a,b){var e=p.domain()[0],f=p.domain()[1]>0?p.domain()[1]:1,g=f/b;gridData=[];for(var h=0;b>=h;h++){val=e+h*g;var i=[val];gridPoints=[];for(var j=0;a>=j;j++)gridPoints.push({x:c(i,j,a),y:d(i,j,a)});gridData.push(gridPoints)}return gridData}var f=60,g=250,h=300,i=(g-f)/2,j=4,k=function(a){return a[0]},l=function(a){return a[1]},m=50,n="spider chart",o="blah",p=d3.scale.linear(),q=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y});return a.margin=function(b){return arguments.length?(f=b,a):f},a.width=function(b){return arguments.length?(h=b,a):h},a.height=function(b){return arguments.length?(g=b,a):g},a.value=function(b){return arguments.length?(k=b,a):k},a.label=function(b){return arguments.length?(l=b,a):l},a.title=function(b){return arguments.length?(n=b,a):n},a.subtitle=function(b){return arguments.length?(o=b,a):o},a.duration=function(b){return arguments.length?(m=b,a):m},a},a.Table=function(){function a(c){c.each(function(c){function l(a){return c.headers.indexOf(a)}var m=this;("undefined"==typeof f||f.rows.length!=c.rows.length)&&(f=$.extend(!0,{},c)),1==k&&""==i&&(k=!1,c=f),""!=i&&(c.rows=b(c.rows,function(a,b){return d(a[l(i)],b[l(i)])}));var n=d3.select(m).selectAll("table").data([c]),o=n.enter().append("table").attr("class","table table-hover bridle").attr("style","margin-top: "+h.top+"px; margin-bottom: "+h.bottom+"px; margin-left: "+h.left+"px; margin-right: "+h.top+"px");o.append("thead").append("tr"),o.append("tbody");var p=n.select("thead").select("tr").selectAll("th").data(function(a){return a.headers});p.enter().append("th");var q=n.select("tbody").selectAll("tr").data(function(a){return a.rows});rowsEnter=q.enter().append("tr"),q.exit().remove();var r=q.selectAll("td").data(function(a){return a});r.enter().append("td"),n.selectAll("th").style("text-align",function(a){return e(a)?"right":"left"}).html(function(a){return a}).on("click",function(b,c){1==k?d3.select(m).call(a.sortBy("")):(c==l(i)?(j=!j,k=!0):k=!1,d3.select(m).call(a.sortBy(b)))}).each(function(a,b){b==l(i)&&(j?d3.select(this).append("span").attr("class","desc"):d3.select(this).append("span").attr("class","asc"))}),n.selectAll("td").style("text-align",function(a){return e(a)?"left":"left"}).text(function(a){if(e(a)){var b=g(a);return b}return a})})}function b(a,d){if(a.length<2)return a;var e=Math.ceil(a.length/2);return c(b(a.slice(0,e),d),b(a.slice(e),d),d)}function c(a,b,c){for(var d=new Array;a.length>0&&b.length>0;)c(a[0],b[0])<=0?d.push(a.shift()):d.push(b.shift());for(;a.length>0;)d.push(a.shift());for(;b.length>0;)d.push(b.shift());return d}function d(a,b){return null===a||null===b?0:("string"==typeof a&&"string"==typeof b&&(a=a.toLowerCase(),b=b.toLowerCase()),j===!0?a>b?-1:a==b?0:1:a>b?1:a==b?0:-1)}function e(a){return!isNaN(parseFloat(a))&&isFinite(a)}var f,g=d3.format(".3f"),h={top:0,bottom:0,left:0,right:0},i="",j=!1,k=!1;return a.margin=function(b){return arguments.length?(h=b,a):h},a.numFormat=function(b){return arguments.length?(g=b,a):g},a.sortBy=function(b){return arguments.length?(i=b,a):i},a.sortDesc=function(b){return arguments.length?(j=b,a):j},a},"function"==typeof window.define&&window.define.amd?window.define("bridle",["jquery","d3"],function(){return a}):window.Bridle=a}();